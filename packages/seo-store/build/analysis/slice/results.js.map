{"version":3,"sources":["../../../src/analysis/slice/results.js"],"names":["createSlice","select","applyFilters","forEach","get","reduce","ASYNC_ACTIONS","ASYNC_STATUS","FOCUS_KEYPHRASE_ID","STORE_NAME","MARKER_STATUS","ANALYZE_ACTION_NAME","analysisAsyncActions","actions","action","analyze","type","request","paper","selectPaper","keyphrases","selectKeyphraseEntries","config","selectAnalysisConfig","preparedPaper","results","payload","processedResults","success","error","defaultResultsState","status","IDLE","seo","focus","score","readability","research","activeMarker","HIDDEN","id","marks","resultsSlice","name","initialState","reducers","updateActiveMarker","state","updateMarkerStatus","extraReducers","builder","addCase","LOADING","SUCCESS","keyphrasePayload","keyphraseId","ERROR","resultsSelectors","selectSeoScore","selectSeoResults","selectReadabilityScore","selectReadabilityResults","selectResearchResults","selectActiveMarker","selectActiveMarkerId","selectActiveMarks","selectMarkerStatus","resultsActions","reducer"],"mappings":"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","sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport { select } from \"@wordpress/data\";\nimport { applyFilters } from \"@wordpress/hooks\";\nimport { forEach, get, reduce } from \"lodash\";\nimport { ASYNC_ACTIONS, ASYNC_STATUS, FOCUS_KEYPHRASE_ID, STORE_NAME, MARKER_STATUS } from \"../../common/constants\";\nimport { ANALYZE_ACTION_NAME } from \"../constants\";\n\nexport const analysisAsyncActions = reduce(\n\tASYNC_ACTIONS,\n\t( actions, action ) => ( { ...actions, [ action ]: `${ ANALYZE_ACTION_NAME }/${ action }` } ),\n\t{},\n);\n\n/**\n * Analyzes the current data.\n *\n * This is a generator function that iterates over the steps to analyze.\n * @see [WP data controls]{@link https://developer.wordpress.org/block-editor/reference-guides/packages/packages-data/#controls-2}\n *\n * @returns {Generator<Object>} Analyze steps.\n */\nexport function* analyze() {\n\tyield { type: analysisAsyncActions.request };\n\n\ttry {\n\t\tconst paper = yield select( STORE_NAME ).selectPaper();\n\t\tconst keyphrases = yield select( STORE_NAME ).selectKeyphraseEntries();\n\t\tconst config = yield select( STORE_NAME ).selectAnalysisConfig();\n\n\t\tconst preparedPaper = yield applyFilters( \"yoast.seoStore.analysis.preparePaper\", paper, { keyphrases, config } );\n\n\t\tconst results = yield { type: ANALYZE_ACTION_NAME, payload: { paper: preparedPaper, keyphrases, config } };\n\n\t\tconst processedResults = yield applyFilters( \"yoast.seoStore.analysis.processResults\", results, {\n\t\t\tpaper: preparedPaper,\n\t\t\tkeyphrases,\n\t\t\tconfig,\n\t\t} );\n\n\t\treturn { type: analysisAsyncActions.success, payload: processedResults };\n\t} catch ( error ) {\n\t\treturn { type: analysisAsyncActions.error, payload: error };\n\t}\n}\n\nexport const defaultResultsState = {\n\tstatus: ASYNC_STATUS.IDLE,\n\terror: \"\",\n\tseo: {\n\t\tfocus: {\n\t\t\tscore: 0,\n\t\t\tresults: [],\n\t\t},\n\t},\n\treadability: {\n\t\tscore: 0,\n\t\tresults: [],\n\t},\n\tresearch: {},\n\tactiveMarker: {\n\t\tstatus: MARKER_STATUS.HIDDEN,\n\t\tid: \"\",\n\t\tmarks: [],\n\t},\n};\n\nconst resultsSlice = createSlice( {\n\tname: \"results\",\n\tinitialState: defaultResultsState,\n\treducers: {\n\t\tupdateActiveMarker: ( state, { payload } ) => {\n\t\t\tstate.activeMarker.id = payload.id;\n\t\t\tstate.activeMarker.marks = payload.marks;\n\t\t},\n\t\tupdateMarkerStatus: ( state, { payload } ) => {\n\t\t\tstate.activeMarker.status = payload;\n\t\t},\n\t},\n\textraReducers: ( builder ) => {\n\t\tbuilder.addCase( analysisAsyncActions.request, ( state ) => {\n\t\t\tstate.status = ASYNC_STATUS.LOADING;\n\t\t} );\n\t\tbuilder.addCase( analysisAsyncActions.success, ( state, { payload } ) => {\n\t\t\tstate.status = ASYNC_STATUS.SUCCESS;\n\n\t\t\t// Update SEO results state for each keyphrase\n\t\t\tforEach( payload.seo, ( keyphrasePayload, keyphraseId ) => {\n\t\t\t\tstate.seo[ keyphraseId ] = {\n\t\t\t\t\tscore: keyphrasePayload.score,\n\t\t\t\t\tresults: keyphrasePayload.results,\n\t\t\t\t};\n\t\t\t} );\n\n\t\t\tstate.readability.score = payload.readability.score;\n\t\t\tstate.readability.results = payload.readability.results;\n\n\t\t\tstate.research = payload.research;\n\t\t} );\n\t\tbuilder.addCase( analysisAsyncActions.error, ( state, { payload } ) => {\n\t\t\tstate.status = ASYNC_STATUS.ERROR;\n\t\t\tstate.error = payload;\n\t\t} );\n\t},\n} );\n\nexport const resultsSelectors = {\n\tselectSeoScore: ( state, id = FOCUS_KEYPHRASE_ID ) => get( state, `analysis.results.seo.${ id }.score` ),\n\tselectSeoResults: ( state, id = FOCUS_KEYPHRASE_ID ) => get( state, `analysis.results.seo.${ id }.results` ),\n\tselectReadabilityScore: ( state ) => get( state, \"analysis.results.readability.score\" ),\n\tselectReadabilityResults: ( state ) => get( state, \"analysis.results.readability.results\" ),\n\tselectResearchResults: ( state, id ) => get( state, `analysis.results.research.${ id }` ),\n\tselectActiveMarker: ( state ) => get( state, \"analysis.results.activeMarker\" ),\n\tselectActiveMarkerId: ( state ) => get( state, \"analysis.results.activeMarker.id\" ),\n\tselectActiveMarks: ( state ) => get( state, \"analysis.results.activeMarker.marks\" ),\n\tselectMarkerStatus: ( state ) => get( state, \"analysis.results.activeMarker.status\" ),\n};\n\nexport const resultsActions = {\n\t...resultsSlice.actions,\n\tanalyze,\n};\n\nexport default resultsSlice.reducer;\n"],"file":"results.js"}